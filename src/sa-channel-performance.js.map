{"version":3,"sources":["sa-channel-performance.es6"],"names":[],"mappings":"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","file":"sa-channel-performance.js","sourcesContent":["class SAChannelPerformance extends HTMLElement {\n    setProperties() {\n        // date resolution\n        this.resolution = 14;\n    };\n\n    /**\n     * on resolution change\n     * @param new value\n     */\n    onResolutionChange(newval) {\n        this.timeline = this.rebuildTimeline(this.data, this.resolution);\n        this.drawTimeline(this.timeline);\n    };\n\n    /**\n     * draw timeline\n     * @param {Array} data\n     */\n    drawTimeline(data) {\n        var height = 50,\n            barWidth = 30;\n\n        var y = d3.scale.linear()\n            .domain([0, d3.max(data.timeline)])\n            .range([0, height]);\n\n        var chart = d3.select(this.viz)\n            .attr(\"height\", height * this.channels.length)\n            .attr(\"width\", barWidth * data.timeline.length);\n\n        var count = 0;\n        chart.selectAll(\"g\")\n            .data(data.timeline)\n            .enter()\n            .append(\"text\")\n            .attr('font-size', '10px')\n            .attr(\"x\", function(d, i) { return i * barWidth + 5; })\n            .attr(\"y\", function() { return 5;})\n            .attr(\"dy\", \".35em\")\n            .text(function(d, i) {\n                var date = new Date(i * data.increment + data.start);\n                return date.getMonth() + '/' + date.getDate() });\n\n        chart.selectAll(\"g\")\n            .data(data.timeline)\n            .enter()\n            .append('line')\n            .attr('x1', function(d, i) { return i * barWidth; })\n            .attr('x2', function(d, i) { return i * barWidth; })\n            .attr('y1', 0 )\n            .attr('y2', height * 50 )\n            .attr('stroke-width', 1)\n            .attr('stroke', '#eaeaea');\n\n        for (var c in this.channels) {\n            var currentID = this.channels[c].id;\n            chart.selectAll(\"g\")\n                .data(data.timeline)\n                .enter().append(\"rect\")\n                .attr(\"height\", function(d, i) { return d[currentID] || 0; })\n                .attr(\"fill\", function(d, i) { return '#ff0000'; })\n                .attr(\"x\", function(d, i) { return i * barWidth + 5; })\n                .attr(\"y\", function(d, i) { return height * count - d[currentID] || 0; })\n                .attr(\"width\", barWidth - 10);\n\n            chart.selectAll(\"g\")\n                .data(data.timeline)\n                .enter()\n                .append(\"text\")\n                .attr('font-size', '10px')\n                .attr(\"x\", 0)\n                .attr(\"y\", height * count + 15)\n                .attr(\"dy\", \".35em\")\n                .text(this.channels[c].id + ' (' + this.channels[c].assetsperday + ' apd)');\n\n            count ++;\n        }\n    };\n\n    /**\n     * rebuild the timeline with new data and resolution\n     *\n     * @param {Object}\n     * @param {Number} resolution\n     * @param {Array} timeline\n     */\n    rebuildTimeline(data, resolution) {\n        var now = new Date().getTime();\n        var timesmap = {};\n        var channels = [];\n        var earliest, latest;\n        for (var c in data) {\n            data[c] = data[c].sort();\n            var channelactivityduration = (now - data[c][0])/ (1000 * 60 * 60 * 24);\n            channels.push({ id: c,  assetsperday: (data[c].length / channelactivityduration).toPrecision(2) });\n            for (var d in data[c]) {\n                this.sanityCheckCount ++;\n                var droppedres = this.changeDateResolution(data[c][d], resolution);\n                if (!timesmap[droppedres]) {\n                    timesmap[droppedres] = {};\n                    if (!earliest || droppedres < earliest) { earliest = droppedres; }\n                    if (!latest || droppedres > latest) { latest = droppedres; }\n                }\n                if (!timesmap[droppedres][c]) { timesmap[droppedres][c] = 0; }\n                timesmap[droppedres][c] ++;\n            }\n        }\n\n        channels.sort( function(a, b) {\n            if (a.assetsperday > b.assetsperday) { return -1; } else { return 1; }\n        });\n        this.channels = channels;\n\n        var timeline = [];\n        var times = earliest;\n        var increment = 1000 * 60 * 60 * 24 * this.resolution;\n        while (times <= latest) {\n            var entries = {};\n            if (timesmap[times]) { entries = timesmap[times]; }\n            timeline.push(entries);\n            times += increment;\n        }\n\n        return { timeline: timeline, start: earliest, increment: increment };\n\n        /*var ttl = 0;\n         for (var c in timeline) {\n         for (var d in timeline[c]) {\n         ttl += timeline[c][d];\n         }\n         }\n         console.log(ttl, ' vs ', this.sanityCheckCount);*/\n    };\n\n    /**\n     * change datetime number resolution so they can be grouped\n     */\n    changeDateResolution(datetime, resolution) {\n        var date = new Date(datetime);\n        var res = 1000 * 60 * 60 * 24 * resolution;\n        return res * parseInt(datetime / res);\n    };\n\n    /**\n     * load data\n     */\n    loadData() {\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener('load', () => {\n            var data = JSON.parse(xhr.response);\n            data = this.rebuildTimeline(data, this.resolution);\n            this.drawTimeline(data);\n        });\n        xhr.open(\"get\", '../data/channelfreq.json', true);\n        xhr.send();\n    };\n\n    /**\n     * parse attributes on element\n     */\n    parseAttributes() {\n    };\n\n\n    // Fires when an instance of the element is created.\n    createdCallback() {\n        this.setProperties();\n        this.parseAttributes();\n    };\n\n    // Fires when an instance was inserted into the document.\n    attachedCallback() {\n        let template = this.owner.querySelector('template');\n        let clone = template.content.cloneNode(true);\n        this.root = this.createShadowRoot();\n        this.root.appendChild(clone);\n\n        this.viz = this.root.querySelector('#viz');\n\n        this.loadData();\n    }\n\n\n    // Fires when an instance was removed from the document.\n    detachedCallback() {};\n\n    // Fires when an attribute was added, removed, or updated.\n    attributeChangedCallback(attr, oldVal, newVal) {};\n\n}\n\nSAChannelPerformance.prototype.owner = (document._currentScript || document.currentScript).ownerDocument;\ndocument.registerElement('sa-channel-performance', SAChannelPerformance);\n"],"sourceRoot":"/source/"}