{"version":3,"sources":["sa-channel-view.es6"],"names":[],"mappings":"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","file":"sa-channel-view.js","sourcesContent":["class SAChannelView extends HTMLElement {\n    /**\n     * set initial properties\n     */\n    setProperties() {\n        this.barcolor = '#ff0000';\n    }\n\n    /**\n     * parse attributes on element\n     */\n    parseAttributes() {\n        if (this.hasAttribute('label')) {\n            this.label = this.getAttribute('label');\n        }\n\n        if (this.hasAttribute('assetsperday')) {\n            this.assetsperday = this.getAttribute('assetsperday');\n        }\n\n        if (this.hasAttribute('activedays')) {\n            this.activedays = this.getAttribute('activedays');\n        }\n\n        if (this.hasAttribute('activity')) {\n            this.activity = this.getAttribute('activity').split(',');\n        }\n\n        if (this.hasAttribute('resolution')) {\n            this.resolution = parseInt(this.getAttribute('resolution'));\n        }\n\n        if (this.hasAttribute('daystolookback')) {\n            this.daystolookback = parseInt(this.getAttribute('daystolookback'));\n        }\n\n        if (this.hasAttribute('barcolor')) {\n            this.barcolor = this.getAttribute('barcolor');\n        }\n    };\n\n    /**\n     * draw timeline\n     * @param {Array} data\n     */\n    drawTimeline(data) {\n        var height = 50,\n            barWidth = 30;\n\n        var y = d3.scale.linear()\n            .domain([0, d3.max(data.timeline)])\n            .range([0, height]);\n\n        var chart = d3.select(this.svg)\n            .attr(\"height\", height)\n            .attr(\"width\", barWidth * data.timeline.length);\n\n        var count = 0;\n        var barcolor = this.barcolor;\n        chart.selectAll(\"g\")\n            .data(data.timeline)\n            .enter()\n            .append(\"text\")\n            .attr('font-size', '10px')\n            .attr(\"x\", function(d, i) { return i * barWidth + 5; })\n            .attr(\"y\", function() { return 5;})\n            .attr(\"dy\", \".35em\")\n            .text(function(d, i) {\n                var date = new Date(i * data.increment + data.start);\n                return date.getMonth()+1 + '/' + date.getDate() });\n\n        chart.selectAll(\"g\")\n            .data(data.timeline)\n            .enter()\n            .append('line')\n            .attr('x1', function(d, i) { return i * barWidth; })\n            .attr('x2', function(d, i) { return i * barWidth; })\n            .attr('y1', 0 )\n            .attr('y2', height)\n            .attr('stroke-width', 1)\n            .attr('stroke', '#eaeaea');\n\n        chart.selectAll(\"g\")\n            .data(data.timeline)\n            .enter().append(\"rect\")\n            .attr(\"height\", function(d, i) { return d; })\n            .attr(\"fill\", function(d, i) { return barcolor; })\n            .attr(\"x\", function(d, i) { return i * barWidth + 5; })\n            .attr(\"y\", function(d, i) { return height - d; })\n            .attr(\"width\", barWidth - 10);\n    };\n\n    /**\n     * rebuild the timeline with new data and resolution\n     *\n     * @param {Object}\n     * @param {Number} resolution\n     * @param {Array} timeline\n     */\n    rebuildTimeline(data, resolution) {\n        var now = new Date().getTime();\n        var timesmap = {};\n        var channels = [];\n        var earliest, latest;\n        for (var c in data) {\n            //this.sanityCheckCount ++;\n            var droppedres = this.changeDateResolution(data[c], resolution);\n            if (!timesmap[droppedres]) {\n                timesmap[droppedres] = 0;\n            }\n            timesmap[droppedres] ++;\n        }\n\n        var timeline = [];\n        var now = this.changeDateResolution(new Date().getTime(), this.resolution);\n        var lookback = this.changeDateResolution(now - this.daystolookback * 24 * 60 * 60 * 1000, this.resolution);\n        var times = lookback;\n        var increment = 1000 * 60 * 60 * 24 * this.resolution;\n        while (times <= now) {\n            var entries = 0;\n            if (timesmap[times]) { entries = timesmap[times]; }\n            timeline.push(entries);\n            times += increment;\n        }\n\n        return { timeline: timeline, start: lookback, increment: increment };\n    };\n\n    /**\n     * change datetime number resolution\n     * @param datetime\n     * @param resolution\n     */\n    changeDateResolution(datetime, resolution) {\n        var date = new Date(datetime);\n        var res = 1000 * 60 * 60 * 24 * resolution;\n        return res * parseInt(datetime / res);\n    };\n\n    // Fires when an instance of the element is created.\n    createdCallback() {};\n\n    // Fires when an instance was inserted into the document.\n    attachedCallback() {\n        this.setProperties();\n        this.parseAttributes();\n\n        let template = this.owner.querySelector('template');\n        let clone = template.content.cloneNode(true);\n        this.root = this.createShadowRoot();\n        this.root.appendChild(clone);\n        this.svg = this.root.querySelector('svg');\n\n        this.labelElement = this.root.querySelector('h1');\n        this.labelElement.innerText = this.label;\n\n        this.activedaysElement = this.root.querySelector('.active-days');\n        this.activedaysElement.innerText = parseInt(this.activedays);\n\n        this.assetsperdayElement = this.root.querySelector('.assets-per-day');\n        this.assetsperdayElement.innerText = parseFloat(this.assetsperday).toPrecision(2);\n\n        var data = this.rebuildTimeline(this.activity, this.resolution);\n        this.drawTimeline(data);\n    }\n\n\n    // Fires when an instance was removed from the document.\n    detachedCallback() {};\n\n    // Fires when an attribute was added, removed, or updated.\n    attributeChangedCallback(attr, oldVal, newVal) {};\n\n}\n\nSAChannelView.prototype.owner = (document._currentScript || document.currentScript).ownerDocument;\ndocument.registerElement('sa-channel-view', SAChannelView);"],"sourceRoot":"/source/"}